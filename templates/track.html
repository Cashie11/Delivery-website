{% extends 'base.html' %}
{% load static %}

{% block title %}Track Package - SwiftTrack{% endblock %}

{% block content %}
<section class="py-4">
    <div class="container">
        <h1 class="text-center mb-3">Track Your Package</h1>

        <!-- Tracking Search Form -->
        <div style="max-width: 600px; margin: 0 auto 3rem;">
            <div class="glass-card">
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_tracking_number">Enter Tracking Number</label>
                        {{ form.tracking_number }}
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Track Package ğŸ”
                    </button>
                </form>
            </div>
        </div>

        <!-- Package Details -->
        {% if package %}
        <div style="max-width: 800px; margin: 0 auto;">
            <!-- Package Info Card -->
            <div class="glass-card mb-3">
                <div
                    style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1rem; margin-bottom: 2rem;">
                    <div>
                        <h2 style="margin-bottom: 0.5rem;">{{ package.tracking_number }}</h2>
                        <span class="status-badge status-{{ package.status }}">
                            {{ package.get_status_display }}
                        </span>
                    </div>
                    {% if package.estimated_delivery %}
                    <div style="text-align: right;">
                        <p style="color: var(--gray-400); margin-bottom: 0.25rem;">Estimated Delivery</p>
                        <p style="font-size: 1.25rem; font-weight: 600; color: var(--accent);">
                            {{ package.estimated_delivery|date:"M d, Y" }}
                        </p>
                    </div>
                    {% endif %}
                </div>

                <!-- Package Details Grid -->
                <div class="grid grid-2" style="margin-bottom: 2rem;">
                    <div>
                        <h4 style="color: var(--primary-light); margin-bottom: 1rem;">ğŸ“¤ Sender</h4>
                        <p><strong>{{ package.sender.name }}</strong></p>
                        <p style="color: var(--gray-400); font-size: 0.9rem;">{{ package.sender.email }}</p>
                        <p style="color: var(--gray-400); font-size: 0.9rem;">{{ package.sender.phone }}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--accent); margin-bottom: 1rem;">ğŸ“¥ Receiver</h4>
                        <p><strong>{{ package.receiver.name }}</strong></p>
                        <p style="color: var(--gray-400); font-size: 0.9rem;">{{ package.receiver.email }}</p>
                        <p style="color: var(--gray-400); font-size: 0.9rem;">{{ package.receiver.phone }}</p>
                    </div>
                </div>

                <div>
                    <h4 style="margin-bottom: 0.5rem;">Package Details</h4>
                    <p style="color: var(--gray-400);">{{ package.description }}</p>
                    <p style="color: var(--gray-400); margin-top: 0.5rem;">
                        <strong>Weight:</strong> {{ package.weight }} kg
                    </p>
                    {% if package.current_location %}
                    <p style="color: var(--gray-400);">
                        <strong>Current Location:</strong> {{ package.current_location }}
                    </p>
                    {% endif %}
                </div>
            </div>

            <!-- Tracking Timeline -->
            <div class="glass-card">
                <h3 style="margin-bottom: 2rem;">ğŸ“ Tracking History</h3>

                {% if tracking_events %}
                <div class="timeline">
                    {% for event in tracking_events %}
                    <div class="timeline-item">
                        <div style="margin-bottom: 0.5rem;">
                            <span class="status-badge status-{{ event.status }}">
                                {{ event.get_status_display }}
                            </span>
                        </div>
                        <p style="font-weight: 600; margin-bottom: 0.25rem;">{{ event.location }}</p>
                        <p style="color: var(--gray-400); font-size: 0.9rem; margin-bottom: 0.25rem;">
                            {{ event.timestamp|date:"M d, Y - H:i" }}
                        </p>
                        {% if event.notes %}
                        <p style="color: var(--gray-500); font-size: 0.875rem;">{{ event.notes }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: var(--gray-400); text-align: center;">No tracking events yet.</p>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}